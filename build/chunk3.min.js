function setup(){pixelDensity(2),noiseSeed(5e4*random()),randomSeed(5e3*random()),cnv=createCanvas(DIM*ratio,DIM),width=DEFAULT_SIZE*ratio,height=DEFAULT_SIZE,background(0),(overallTexture=createGraphics(width,height,WEBGL)).shader(shTxt),shTxt.setUniform("u_resolution",[width,height]),overallTexture.rect(-width/2,-height/2,width,height),wC=createGraphics(width,height,WEBGL),oG=createGraphics(width,height),olayG=createGraphics(width,height),wC.noStroke(),olayG.noStroke(),oG.noStroke();var e,t=random([-.1,-.05,0,0,.05,.1])*width,o=random([-.1,-.05,0,0,.05,.1])*height,r=random([-.2,-.1,.1,.2]),a=random([.95,1,1.05,1.1]);for(e of[oG,olayG])e.translate(t,o),e.translate(width/2,height/2),e.rotate(r),e.scale(a),e.scale(.9),e.translate(-width/2,-height/2);background(100),oG.noStroke(),bgColor=color(random(colors)),random()<.5&&(bgColor=color(random([sortedColors[0],sortedColors.slice(-1)[0]]))),"glow"==features.style&&(bgColor=color(0)),"pure"==features.style&&(bgColor=color(colors[2]));var i=int(random(7)),s=[12,14,16,20,32,44,60,68,72],n=[240,280,340,380,520,560,700,760,820],h=features.minPairId,l=features.maxPairId;let d=s[i],c=n[i];var p=random([10,20,100,200]),u=random([.05,.3]),m=random([150,200,250,300]),g=random([.35,.4,.45,.5]);random([0,1,2,5,10,15,20,25]),random([0,0,random([0,5,10,15])]);if("natural"==features.layout){for(let t=0;t<=width;t+=d)if(!(noise(t/2)<u)){var f,F="rect"==features.shapeType?-.8:-.85;if(!(sin(t+seed*PI)<F))for(let e=0;e<=height;e+=d)noise(t/m,e/m)<=g||(particles.push(new Particle({p:createVector(t,e),r:noise(t,e)*c*random(1),color:colors[int(noise(t/m*2,e/m*2)*colors.length*2)%colors.length]})),f=int(map(noise(t/p,e/p),0,1,h,l)),d=s[f],c=n[f])}}else if("ring"==features.layout||"pie"==features.layout){let t=map(noise(seed),0,1,.25,.4)*width,e=map(noise(seed+1),0,1,.5,.7)*width,o=width/2,r=height/2;"pie"==features.layout&&(manRingR=0,o=random([0,1])*width,r=random([0,1])*height,t=width/3,e=map(noise(seed+1),0,1,1,.75)*width,d*=.9);for(var w=0;w<=2*PI;w+=.1)for(var v=t;v<e;v+=d){var C=v*cos(w)+o,y=v*sin(w)+r,b=1.5*sqrt(v)+noise(C,y)*c/1.5*random(1);noise(C/m,y/m)<=g/1.5||(particles.push(new Particle({p:createVector(C,y),r:b,color:colors[int(noise(v/m*1.5,1.5*w)*colors.length*2)%colors.length]})),b=int(map(noise(C/p,y/p),0,1,h,l)),d=s[b],c=n[b])}for(let e=0;e<50;e++)particles.push(new Particle({p:createVector(width/2+random(.3*-t,.3*t),height/2+random(.3*-t,.3*t)),r:random(t/1.9),color:random(colors)}))}else if("blocks"==features.layout){var A="rect"==features.shapeType?+c:"polygon"==features.shapeType?1.3*c:c,k=random()<.5,T=map(noise(seed),0,1,.1,.15)*(k?height:width),P=map(noise(seed+1),0,1,.3,.5)*(k?width:height);for(let o=-1;o<=1;o++)for(var G=-T;G<T;G+=d)for(var x=-P;x<P;x+=d){let e=G+o*T*3+(k?width:height)/2,t=x+o*P/2+(k?width:height)/2;k&&(I=e,e=t,t=I),particles.push(new Particle({p:createVector(e,t),r:noise(G,x)*A*random(1)*random(1),color:colors[int(noise(e/m,t/m,500*o)*colors.length*4)%colors.length]}));var I=int(map(noise(G/p,x/p),0,1,h,l));d=s[I],c=n[I]}}else if("spiral"==features.layout){var W=map(noise(5*seed),0,1,.65,1.05),q=(map(noise(seed),0,1,.1,.15),width,map(noise(seed+1),0,1,.3,.5),height,"rect"==features.shapeType?1.2*c:(features.shapeType,1.25*c));for(let t=0;t<.6*width;t+=d/2)for(let e=0;e<=.15*PI;e+=.05){var S=W*(t+noise(500*e)*t*.6+map(e,PI/2,PI,0,1,!0)*noise(100*t)*width/1.2),_=S*cos(e+0*PI+t/40)+width/2,S=S*sin(e+0*PI+t/40)+height/2,_=(particles.push(new Particle({p:createVector(_,S),r:1.5*sqrt(t)+noise(t/4,e/4)*q*random(1)*random(1),color:colors[int(noise(t/m,2*e)*colors.length*3)%colors.length]})),int(map(noise(G/p,x/p),0,1,h,l)));d=s[_],c=n[_]}}else if("chess"==features.layout){var R=random([0,1]);for(let t=0;t<=width;t+=d)if(!(noise(t/2)<u)){features.shapeType;for(let e=0;e<=height;e+=d){var U=random([2,3]),E=int(t/(width/U)),U=int(e/(height/U));(E+U+R)%2==1||noise(t,e)<u||(particles.push(new Particle({p:createVector(t,e),r:(.5+noise(t,e)/2)*c/2*random(1),color:colors[max(int(E*colors.length/3+U*colors.length/3+noise(t/g,e/g)*colors.length),0)%colors.length]})),E=int(map(noise(t/p,e/p),0,1,h,l)),d=s[E],c=n[E])}}}for(let e=0;e<features.wormholeCount;e++){var Y=new Wormhole({p:createVector(random(.2*-width,1.2*width),random(.2*-height,1.2*height)),r:random(100,600),intensity:random([-1,1])/10,rotate:random([-1,1]),attract:random([-1,1])});wormholes.push(Y)}noLoop();let L=500,B=L,V=[[126.7180202224328,74.62338403438254],[125.71668153434713,73.62238102535545],[117.70597202966172,70.61937199827422],[112.69927858923334,69.61836898924713],[100.68321433220522,69.61836898924713],[91.67116613943413,71.62037500730129],[87.66581138709144,72.62137801632838],[69.64171500154927,79.62839907951795],[62.63234418494954,87.63642315173459],[57.62565074452115,96.64545023297832],[56.62431205643548,99.64845926005957],[57.62565074452115,108.6574863413033],[58.626989432606834,109.65848935033038],[69.64171500154927,113.6625013864387],[98.68053695603388,110.65949235935746],[112.69927858923334,105.65447731422206],[136.73140710328957,96.64545023297832],[166.77156774585984,79.62839907951795],[170.77692249820254,75.62438704340963],[173.78093856245957,73.62238102535545],[173.78093856245957,74.62338403438254],[169.77558381011687,78.62739607049086],[169.77558381011687,79.62839907951795],[168.7742451220312,81.63040509757211],[168.7742451220312,81.63040509757211],[169.77558381011687,80.62940208854502],[171.77826118628823,78.62739607049086],[177.7862933148023,76.6253900524367],[178.78763200288796,76.6253900524367],[183.79432544331632,81.63040509757211],[183.79432544331632,82.6314081065992],[185.7970028194877,84.63341412465336],[185.7970028194877,84.63341412465336],[202.81976051694417,79.62839907951795],[209.82913133354393,74.62338403438254],[210.8304700216296,74.62338403438254],[210.8304700216296,76.6253900524367],[209.82913133354393,78.62739607049086],[209.82913133354393,79.62839907951795],[226.8518890310004,79.62839907951795],[231.85858247142878,77.62639306146379],[236.86527591185717,72.62137801632838],[237.86661459994284,72.62137801632838],[237.86661459994284,72.62137801632838],[237.86661459994284,73.62238102535545],[241.87196935228556,73.62238102535545],[259.8960657378277,72.62137801632838],[260.8974044259134,71.62037500730129],[260.8974044259134,71.62037500730129],[261.89874311399905,72.62137801632838],[269.9094526186845,74.62338403438254],[275.91748474719856,74.62338403438254],[281.9255168757126,74.62338403438254],[310.9643388301972,68.61736598022006],[326.985757839568,64.61335394411172],[345.0098542251102,59.60833889897632],[366.0379666749094,54.60332385384092],[369.04198273916643,53.60232084481383],[371.04466011533776,51.60031482675967]],D=()=>{draw(),frameCount=L-B,pushpop(()=>{scale(M),translate(width/2,height/2),textSize(200),noStroke(),fill(255),arc(0,0,100,100,0,B/L*PI*2);let t=V.slice(0,int(V.length*(1-B/L)));pushpop(()=>{beginShape(),noFill(),stroke(255),scale(.6),rotate(.05),translate(-200,100);for(var e of t)curveVertex(e[0],e[1]);strokeWeight(2.5),endShape()})}),0<B?requestAnimationFrame(D):drawToMainCanvas(),drawToMainCanvas(),--B};requestAnimationFrame(D)}function drawToMainCanvas(){pushpop(()=>{scale(M),wC.shader(sh1),sh1.setUniform("u_resolution",[width,height]),sh1.setUniform("u_time",millis()/1e3),sh1.setUniform("u_mouse",[mouseX/width,mouseY/height]),sh1.setUniform("u_tex",oG),sh1.setUniform("u_bgColor",[bgColor._getRed()/255,bgColor._getGreen()/255,bgColor._getBlue()/255]),sh1.setUniform("u_canvas_tex",overallTexture),sh1.setUniform("u_distortFactor",features.distortFactor),sh1.setUniform("u_hasBorder",features.hasBorder),wC.clear(),background(100),fill(0),rect(0,0,2*width,2*height),wC.rect(-width/2,-height/2,width,height),fill(bgColor),rect(0,0,width,height);pushpop(()=>{if(features.hasGrid){if("rect"==features.shapeType){push(),blendMode(MULTIPLY);for(let e=-40;e<=width+20;e+=20)stroke(0,20),line(e,0,e,height);for(let e=-40;e<=height+20;e+=20)stroke(0,20),line(0,e,width,e);pop()}if("ellipse"==features.shapeType){blendMode(BLEND);for(var e=0;e<3;e++){push(),strokeWeight(1),translate(width/2,height/2),rotate(e/3*PI*2),translate(-width/2,-height/2);for(let e=-160;e<=width+80;e+=50)stroke(255,80),line(e,0,e,height+200);pop()}}}}),pushpop(()=>{drawingContext.filter="",image(wC,0,0),"glow"==features.style&&(blendMode(SCREEN),drawingContext.globalAlpha=.3,drawingContext.filter="blur(100px)",image(wC,20,20),pop())}),pushpop(()=>{image(olayG,0,0)}),pushpop(()=>{blendMode(MULTIPLY),noStroke(),image(overallTexture,0,0)})})}function draw(){oG.noStroke(),particles.forEach(e=>{e.update(),e.draw(oG)}),particles=particles.filter(e=>e.alive)}function keyPressed(){"s"==key&&saveCanvas(tokenData.hash+".png"),"b"==key&&(features.hasBorder=!features.hasBorder)}